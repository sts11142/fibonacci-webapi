---
title: 'ユニットテストを実装する'
author: 'ss'
date: '2023-07-01'
---

# ユニットテストを実装したい

## けど，rails でどうやって実装するんだろう！

rails も api テストも初心者なので，どこから手をつけて良いか不明です．

テスト駆動型開発（TDD）といった細かい議論はやめて，今回は素直に [Rails チュートリアルで紹介されているテスト方法](https://railstutorial.jp/chapters/static_pages?version=7.0#sec-our_first_test)のお作法を参考にしてみます．

加えて，railsアプリのテストにはRSpecというテスティングフレームワークを使うのが一般的のようです．  
今回のテストの規模は小さいですが，今後の練習も兼ねてRSpecを利用してみます．

### 事前にテストを作成することのメリット・デメリット
メリット

- テスト漏れが重大なインシデントとなるロジックや，他のロジックと関連しているものに対して有効
- 全テストケース合格 ≒ 実装完了（恐らく？）

デメリット

- 仕様（in/out）が変わった場合，テストが無駄になる

今回は要求仕様が決まっていて，変化することもないので，事前にテストを作成する方針にしました．

### RSpecについて
Rspecは，Rubyにおけるテスティングフレームワークです．  
ドキュメント記述のようにテストケースを作成することができるとのこと．ワクドキ

---

## ユニットテストの流れ

基本的に，「開発＝テストケース全合格」の流れで開発を行います．  
テストケースを満たしていれば，すなわち実装完了とします．（このやり方が正しいのかは分からない...）

1. path `/fb`を作成する
    - controller, routes
1. `/fb`に対するテストを作成する
1. そのテストを実行し，エラーを確認する
1. そのテストを満たすようにコーディングを行う
1. テストがオールグリーンになるまで{コーディング→テスト}を繰り返す

---

# テストケースを作成する！！
実装の前にテストケースを作成します．このテストをクリアしたら実装完了，と言うためには，テストケースを網羅する必要があります...が今回はテスト対象が1ルートだけなので，恐らく簡単（？）

## テストケース

テストケースを考えます．  
といっても今回は，パラメータの値が正しい場合と正しくない場合の2種類のみですが！

| パラメータ`n`の値 | status・json |
| - | - |
| ?n=10 | 200・{ "result": 50 } |
| ?n=0 | 200・{ "result": 0 } |
| ?n=1 | 200・{ "result": 1 } |
| ?n=1.5 | 400・{ "status": 400, "errors": <br />[{"type": "invalid-parameter", "title": "パラメータの値が不正です"}] } |
| ?n=(指定なし) | 400・{ "status": 400, "errors": <br />[{"type": "invalid-parameter", "title": "パラメータの値が不正です"}] } |
| /fb (?n= が無し) | 400・{ "status": 400, "errors": <br />[{"type": "invalid-parameter", "title": "パラメータの値が不正です"}] } |
| ?n="string" | 400・{ "status": 400, "errors": <br />[{"type": "invalid-parameter", "title": "パラメータの値が不正です"}] } |
| | |


フィボナッチ数はn=0,1の時の値が定義されているため，検証を行います（境界値分析っぽく）．  
また，最大数は考慮しません（rubyは整数型の最大幅が無限...固定長の長さを超えるとメモリ依存の無限多倍長整数に拡張されるとのこと．wow）


# API（ユニットテスト）を実装する！！

ユニットテストの流れを参考にして，早速コーディングします！

## Controllerの生成
`fb`Controllerを`generate`して，apiのエンドポイントを作成します．同時にルーティングも対応させます．

